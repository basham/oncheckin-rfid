<!DOCTYPE html>
<html>
<head>
	<title>Prototype</title>
<script src="/socket.io/socket.io.js"></script>
<script type="text/javascript" src="/js/jquery-1.5.min.js"></script>
<script> 
	var socket = new io.Socket('localhost', { port: 3000 }); 
	socket.connect();
	socket.on('connect', function(){ message('Connected client-side') });
	socket.on('message', function(obj) {
		if ( 'message' in obj )
			message(obj.message);
		/*
		if ( 'data' in obj ) {
			for (var d in obj.data)
				data( obj.data[d] );
		}
		*/
		if( 'type' in obj ) {
			switch( obj.type ) {
				case 'assign':
					message('Assign: ' + obj.data);
					break;
				case 'checkin':
					checkin(obj.data);
					break;
			}
		}
	});
	socket.on('disconnect', function(){ });
	
	function message(msg) {
		$('#console').prepend('<li><em>' + msg + '</em></li>');
	}
	
	function data(d) {
		$('#console').prepend('<li>' + d + '</li>');
	}
	
	function checkin(hasher) {
		hasher = new Hasher(hasher);
		var msg = '';
		msg += '<strong>' + hasher.hashname + '</strong>';
		msg += hasher.isAnniversary() ? '<p>You\'re celebrating your <mark>' + hasher.hashes + ' hash</mark>.</p>' : '<p>Today is your <mark>' + hasher.hashes + ' hash</mark>.</p>';
		msg += hasher.isReturner() ? '<p>You haven\'t come since <mark>' + hasher.lasthash + '</mark>.</p>' : '';
		msg += hasher.isNaming() ? '<p>Today is your <mark>naming</mark>.</p>' : '';
		$('#console').prepend('<li>' + msg + '</li>');
	}
	
	$(document).ready(function() {
		
		$('#btn').click(function() {
			message('Clearing');
			socket.send({ action: 'clear' });
		});
		
		$('#firstname').keyup(function() {
			if( !$('#hashname').hasClass('default') )
				return;
			$('#hashname').val( defaultHashname() );
		});

		$('#hashname').keyup(function() {
			if( $(this).val() == defaultHashname() )
				$(this).addClass('default');
			else
				$(this).removeClass('default');
		});

		$('#hashname').blur(function() {
			if( $(this).val().length == 0 )
				$(this).addClass('default').val( defaultHashname() );
		});
		
		function defaultHashname() {
			return $('#firstname').val().length > 0 ? 'Just ' + $('#firstname').val() : ''
		}
		
	});
	
	var latesthash = '20110219';
	
	function Hasher(obj) {
		this.id = obj.id;
		this.firstname = obj.firstname || '';
		this.lastname = obj.lastname || '';
		this.hashname = obj.hashname ? obj.hashname : 'Just ' + this.firstname;
		this.rfid = obj.rfid || '';
		this.hashes = parseInt(obj.hashes) || 0;
		this.hares = parseInt(obj.hares) || 0;
		this.lasthash = obj.lasthash || latesthash;

		this.isAnniversary = function() {
			return ( this.hashes % 5 == 0 && this.hashes > 0 ) || this.hashes == 69;
		};
		this.isNaming = function() {
			return this.hashes > 0 && this.hashname.length == 0;
		};
		this.isReturner = function() {
			return this.lasthash < latesthash;
		}
		this.isVirgin = function() {
			return this.hashes == 0;
		}
	}
	
	/*
	var upp = new Hasher({
		firstname: 'Chris',
		lastname: 'Basham',
		hashname: 'Untouched Private Panther',
		rfid: '3D002123221D',
		hashes: 15,
		hares: 1,
		lasthash: '20110219' });
	
	var rob = new Hasher({
		firstname: 'Rob',
		lastname: 'Begley',
		hashname: '',
		rfid: '31007E195503',
		hashes: 9,
		hares: 0,
		lasthash: '20101211' });
		*/
	/*
	      function message(obj){
        var el = document.createElement('p');
        if ('announcement' in obj) el.innerHTML = '<em>' + esc(obj.announcement) + '</em>';
        else if ('message' in obj) el.innerHTML = '<b>' + esc(obj.message[0]) + ':</b> ' + esc(obj.message[1]);
        document.getElementById('chat').appendChild(el);
        document.getElementById('chat').scrollTop = 1000000;
      }
      
      function send(){
        var val = document.getElementById('text').value;
        socket.send(val);
        message({ message: ['you', val] });
        document.getElementById('text').value = '';
      }
      
      function esc(msg){
        return msg.replace(/</g, '&lt;').replace(/>/g, '&gt;');
      };
      
      var socket = new io.Socket(null, {port: 8080, rememberTransport: false});
      socket.connect();
      socket.on('message', function(obj){
        if ('buffer' in obj){
          document.getElementById('form').style.display='block';
          document.getElementById('chat').innerHTML = '';
          
          for (var i in obj.buffer) message(obj.buffer[i]);
        } else message(obj);
      });
*/

</script> 

<style type="text/css">

@import '/css/reset.css';

body {
	overflow-x: hidden;
	background: #CCC;
	font-family: 'Helvetica Neue', Helvetica, sans-serif; }

#nav {
	position: fixed;
	width: 280px;
	height: 100%;
	background: #DDDDDD; }

#body {
	position: absolute;
	left: 280px;
	height: 100%; }

h1 {
	padding: 20px;
	font-size: 24px;
	font-weight: 200; }

nav {
	padding: 20px; }

nav li {
	font-size: 24px;
	padding: 10px 0; }

nav li span {
	font-weight: bold; }

#console {
	padding: 20px; }

#console li {
	opacity: .25;
	font-weight: 200;
	font-size: 200%; }

#console li p {
	color: rgba(0, 0, 0, .5);
	display: none; }

#console li mark {
	color: rgba(0, 0, 0, 1);
	background: none; }
	
#console li:first-child {
	opacity: 1;
	margin-bottom: 20px; }
	
#console li:first-child strong {
	font-size: 200%;
	font-weight: 200; }

#console li:first-child p {
	display: block; }

#overlay {
	position: fixed;
	width: 100%;
	height: 100%;
	background: rgba(0, 0, 0, .8);
	z-index: 100; }

.module {
	position: absolute;
	width: 360px;
	left: 312px;
	z-index: 200;
	border-radius: 0 0 10px 10px;
	background: white;
	padding: 20px 30px; }

.module hgroup {
	padding: 0 0 20px;
	border-bottom: 1px solid rgba(0, 0, 0, .2); }

.module hgroup h2 {
	color: rgba(0, 0, 0, .5);
	font-weight: 200;
	font-size: 24px; }

.module hgroup h2 span {
	font-size: 85%;
	padding-left: 5px;
	color: rgba(0, 0, 0, .2); }

.close {
	float: right;
	color: rgba(0, 0, 0, .2);
	background: rgba(0, 0, 0, .1);
	padding: 0 10px;
	border-radius: 5px;
	line-height: 26px;
	height: 32px;
	font-weight: bold;
	text-decoration: none;
	font-size: 24px; }

.close:hover {
	color: white;
	background: rgba(0, 0, 0, .2); }

.module form {
	padding: 20px 0 0;
	background: rgba(255, 255, 255, .8); }

button {
	font-size: 16px;
    padding: .5em 1em;
    background-color: rgba(0, 0, 0, .1);
    border: 1px solid rgba(0, 0, 0, .2);
    border-radius: 5px;
    text-shadow: rgba(0, 0, 0, .1) 0 -1px 0;
    background: -webkit-gradient(linear, 0 0, 0 100%, from(#FFFFFF), to(#E5E5E5)); }

button:hover {
    border-color: rgba(50, 120, 224, .5);
    background: -webkit-gradient(linear, 0 0, 0 100%, from(#FFFFFF), to(#eaf1fc)); }

button:active {
    background: -webkit-gradient(linear, 0 0, 0 100%, from(#eaf1fc), to(#FFFFFF)); }


.module input {
	display: block;
	font-size: 20px;
	width: 342px;
    padding: .5em;
    background-color: rgba(0, 0, 0, .1);
    border: 1px solid rgba(0, 0, 0, .2);
    border-radius: 5px;
    text-shadow: rgba(0, 0, 0, .1) 0 -1px 0;
    background: rgba(0, 0, 0, .025); }

input.default {
	color: rgba(0, 0, 0, .5);
}

label {
	text-transform: uppercase;
	color: rgba(0, 0, 0, .4);
	font-size: 12px;
}

form p {
	clear: both;
	padding: 0 0 10px; }

.grid-2 p {
	clear: none;
	float: right; }

.grid-2 p:first-child {
	float: left; }


.grid-2 p input {
	width: 150px; }

</style>

</head>

<body>

<div id="overlay"></div>

<section id="assign" class="module">
	<head>
	<hgroup>
		<a class="close" href="#">x</a>
		<h2>Assign tag <span>31007E05450F</span></h2>
	</hgroup>
	<form>
		<div class="grid-2">
			<p><label>First name <input id="firstname"/></label></p>
			<p><label>Last name <input id="lastname"/></label></p>
		</div>
		<p><label>Hash name <input id="hashname" class="default"/></label></p>
		<button>Assign</button>
	</form>
</section>

<section id="nav">

<h1 id="hash-title" class="bind">Hash of the Titans</h1>

<nav>
	<ul>
		<li><span>4</span> Anniversaries</li>
		<li><span>1</span> Late sign-in</li>
		<li><span>2</span> Namings</li>
		<li><span>8</span> Returners</li>
		<li><span>0</span> Visitors</li>
		<li><span>5</span> Virgins</li>
	</ul>
</nav>
	
</section>

<section id="body">

<ol id="console"></ol>

<p><button id="btn">Clear</button></p>

</section>

</body>
</html>